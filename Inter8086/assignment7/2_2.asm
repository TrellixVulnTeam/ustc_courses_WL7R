PORT_DATA EQU 3020H
PORT_MODE EQU 3021H


CODE SEGMENT 
	ASSUME DS:DATA, CS:CODE
START:	
		CALL INIT
		CALL DELLY
		MOV AL, 01111110B  ;一个停止位， 偶校验， 字符长度位8位， 异步方式x16
		MOV DX, PORT_MODE
		OUT DX, AL  
		CALL DELLY
		MOV AL, 00110100B	;允许接收， 禁止发送
		OUT DX, AL
		CALL DELLY
		
A1:
		CALL READ
		CALL DELLY 
		JMP A1
INIT	PROC
	MOV AL, 00H
	MOV DX, PORT_MODE
	OUT DX, AL 
	CALL DELLY
	OUT DX, AL
	CALL DELLY
	OUT DX, AL
	CALL DELLY
	MOV AL, 40H
	OUT DX, AL
	RET

DELLY	PROC
	PUSH CX
	MOV CX, 0003H
A5:	PUSH AX
	POP AX
	LOOP A5
	POP CX
	RET  
	
READ	PROC   
	PUSH DX
	PUSH AX   
	MOV DX, PORT_MODE
A9:	IN AL, DX
	AND AL, 02H
	JZ A10
	MOV DX, PORT_DATA
	IN AL, DX
	MOV DL, AL
	MOV AH, 02H
	INT 21H
	POP AX
	POP DX
	RET
A10: 	MOV AH, 1
		INT 16H
		JZ	A9	
		MOV AX, 4C00H
		INT 21H	
	
	
CODE ENDS
	END START